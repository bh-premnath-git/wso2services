[server]
hostname = "localhost"
node_ip = "127.0.0.1"
base_path = "https://$ref{server.hostname}:${carbon.management.port}"

[super_admin]
username = "admin"
password = "admin"
create_admin_account = true

[user_store]
type = "database_unique_id"

[database.identity_db]
type = "mysql"
url = "jdbc:mysql://mysql-wso2:3306/WSO2_IDENTITY_DB?useSSL=false&amp;allowPublicKeyRetrieval=true&amp;characterEncoding=UTF-8&amp;connectionCollation=utf8mb4_unicode_ci"
username = "wso2carbon"
password = "wso2carbon"
driver = "com.mysql.cj.jdbc.Driver"
validationQuery = "SELECT 1"

[database.shared_db]
type = "mysql"
url = "jdbc:mysql://mysql-wso2:3306/WSO2_SHARED_DB?useSSL=false&amp;allowPublicKeyRetrieval=true&amp;characterEncoding=UTF-8&amp;connectionCollation=utf8mb4_unicode_ci"
username = "wso2carbon"
password = "wso2carbon"
driver = "com.mysql.cj.jdbc.Driver"
validationQuery = "SELECT 1"

[keystore.primary]
file_name = "wso2carbon.p12"
password = "wso2carbon"
type="PKCS12"

[truststore]
file_name="client-truststore.p12"
password="wso2carbon"
type="PKCS12"

[account_recovery.endpoint.auth]
hash= "66cd9688a2ae068244ea01e70f0e230f5623b7fa4cdecb65070a09ec06452262"

[identity.auth_framework.endpoint]
app_password= "dashboard"

# The KeyStore which is used for encrypting/decrypting internal data. By default the primary keystore is used as the internal keystore.

#[keystore.internal]
#file_name = "$ref{keystore.primary.file_name}"
#type = "$ref{keystore.primary.type}"
#password = "$ref{keystore.primary.password}"
#alias = "$ref{keystore.primary.alias}"
#key_password = "$ref{keystore.primary.key_password}"

# The KeyStore which is used for tls communication. By default the primary keystore is used as the tls keystore.

#[keystore.tls]
#file_name = "$ref{keystore.primary.file_name}"
#type = "$ref{keystore.primary.type}"
#password = "$ref{keystore.primary.password}"
#alias = "$ref{keystore.primary.alias}"
#key_password = "$ref{keystore.primary.key_password}"

#Google reCAPTCHA settings.

#[recaptcha]
#enabled = true
#api_url = "https://www.google.com/recaptcha/api.js"
#verify_url = "https://www.google.com/recaptcha/api/siteverify"
#site_key = ""
#secret_key = ""

# SMTP email sender settings.
#[output_adapter.email]
#from_address= "abcd@gmail.com"
#username= "abcd"
#password= "xxxx"
#hostname= "smtp.gmail.com"
#port= 587

# OAuth config
[oauth]
authorize_all_scopes = true

# CORS configuration for OAuth/OIDC flows from frontend applications
[cors]
allow_generic_http_requests = true
allow_any_origin = false
allowed_origins = [
    "http://localhost:3000",
    "http://localhost:3001",
    "http://localhost:5173",
    "http://localhost:8080",
    "http://localhost:4200",
    "http://127.0.0.1:3000",
    "http://127.0.0.1:5173"
]
allow_subdomains = false
supported_methods = [
    "GET",
    "POST",
    "HEAD",
    "OPTIONS",
    "PUT",
    "DELETE",
    "PATCH"
]
support_any_header = true
supported_headers = []
exposed_headers = []
supports_credentials = true
max_age = 3600

# Expose /scim2/Me for APIM UserInfo calls
[[resource.access_control]]
context = "(.*)/scim2/Me"
secure = true
http_method = "GET"
cross_tenant = true
permissions = []
scopes = []

# Allow APIM to access DCR endpoints for OAuth app management
# Fix for 401 error when APIM tries to retrieve application details
[[resource.access_control]]
context = "(.*)/api/identity/oauth2/dcr/v1.1/register(.*)"
secure = true
http_method = "GET"
permissions = ["/permission/admin/manage/identity/applicationmgt/view"]
scopes = []

[[resource.access_control]]
context = "(.*)/api/identity/oauth2/dcr/v1.1/register(.*)"
secure = true
http_method = "POST"
permissions = ["/permission/admin/manage/identity/applicationmgt/create"]
scopes = []

[[resource.access_control]]
context = "(.*)/api/identity/oauth2/dcr/v1.1/register(.*)"
secure = true
http_method = "DELETE"
permissions = ["/permission/admin/manage/identity/applicationmgt/delete"]
scopes = []

[[resource.access_control]]
context = "(.*)/api/identity/oauth2/dcr/v1.1/register(.*)"
secure = true
http_method = "PUT"
permissions = ["/permission/admin/manage/identity/applicationmgt/update"]
scopes = []

# Token revocation notifier → APIM
[[event_listener]]
id = "token_revocation"
type = "org.wso2.carbon.identity.core.handler.AbstractIdentityHandler"
name = "org.wso2.is.notification.ApimOauthEventInterceptor"
order = 1

[event_listener.properties]
notification_endpoint = "https://wso2am:9443/internal/data/v1/notify"
username = "${admin.username}"
password = "${admin.password}"
'header.X-WSO2-KEY-MANAGER' = "WSO2-IS"

# Optional: Role management from APIM (requires update levels ≥ 4.4.0.5 / 7.0.0.81)
[role_mgt]
allow_system_prefix_for_role = true
